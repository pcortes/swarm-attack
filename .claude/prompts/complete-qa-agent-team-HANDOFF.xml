<?xml version="1.0" encoding="UTF-8"?>
<implementation_prompt>
  <metadata>
    <title>Complete Adaptive QA Agent - Expert Team TDD (HANDOFF)</title>
    <worktree>/Users/philipjcortes/Desktop/swarm-attack-qa-agent</worktree>
    <branch>feature/adaptive-qa-agent</branch>
    <spec>/Users/philipjcortes/Desktop/swarm-attack/docs/ADAPTIVE_QA_AGENT_DESIGN.md</spec>
    <validation_report>/Users/philipjcortes/Desktop/swarm-attack-qa-agent/docs/QA_VALIDATION_REPORT.md</validation_report>
    <current_status>100% spec-complete, 933 tests passing, all gaps closed</current_status>
    <handoff_date>2025-12-30</handoff_date>
  </metadata>

  <worktree_setup>
    <description>This work uses a dedicated git worktree. DO NOT create a new one - it already exists.</description>

    <existing_worktree>
      <path>/Users/philipjcortes/Desktop/swarm-attack-qa-agent</path>
      <branch>feature/adaptive-qa-agent</branch>
      <parent_repo>/Users/philipjcortes/Desktop/swarm-attack</parent_repo>
    </existing_worktree>

    <verification_first priority="CRITICAL">
      <instruction>Before ANY work, verify you are in the correct worktree:</instruction>
      <commands>
        <![CDATA[
cd /Users/philipjcortes/Desktop/swarm-attack-qa-agent
pwd      # Must show: /Users/philipjcortes/Desktop/swarm-attack-qa-agent
git branch --show-current   # Must show: feature/adaptive-qa-agent
        ]]>
      </commands>
      <on_failure>STOP - You are in the wrong directory. Navigate to the correct worktree.</on_failure>
    </verification_first>

    <if_worktree_missing>
      <note>The worktree should already exist. If it doesn't, recreate it from the parent repo:</note>
      <commands>
        <![CDATA[
cd /Users/philipjcortes/Desktop/swarm-attack
git worktree add ../swarm-attack-qa-agent feature/adaptive-qa-agent
cd /Users/philipjcortes/Desktop/swarm-attack-qa-agent
        ]]>
      </commands>
    </if_worktree_missing>

    <warning>
      DO NOT work in /Users/philipjcortes/Desktop/swarm-attack (parent repo).
      All QA Agent work MUST happen in /Users/philipjcortes/Desktop/swarm-attack-qa-agent (worktree).
    </warning>
  </worktree_setup>

  <baseline_test_results>
    <timestamp>2025-12-30T15:00:00Z</timestamp>
    <test_command>PYTHONPATH=. python -m pytest tests/unit/qa/ tests/integration/qa/ --tb=no -q</test_command>
    <result>933 passed, 24 warnings in 225.55s</result>
    <note>DO NOT re-run baseline - use this as your starting point</note>
  </baseline_test_results>

  <completed_gaps>
    <gap id="GAP-001" status="COMPLETED">
      <title>ContractValidatorAgent IMPLEMENTED</title>
      <evidence>
        <file>swarm_attack/qa/agents/contract.py</file>
        <test_file>tests/unit/qa/test_contract.py (756 lines)</test_file>
        <import_test>PYTHONPATH=. python -c "from swarm_attack.qa.agents import ContractValidatorAgent; print('OK')"</import_test>
      </evidence>
    </gap>

    <gap id="GAP-002" status="COMPLETED">
      <title>Request Generation Edge Cases (10.4)</title>
      <evidence>
        <test_file>tests/unit/qa/test_request_generation_edge_cases.py (529 lines)</test_file>
      </evidence>
    </gap>

    <gap id="GAP-003" status="COMPLETED">
      <title>Database Race Condition Tests (10.6)</title>
      <evidence>
        <test_file>tests/unit/qa/test_database_state_edge_cases.py (508 lines)</test_file>
      </evidence>
    </gap>

    <gap id="GAP-004" status="COMPLETED">
      <title>Auth Flow Tests (10.2)</title>
      <evidence>
        <test_file>tests/unit/qa/test_auth_edge_cases.py (421 lines, 76 tests)</test_file>
      </evidence>
    </gap>

    <gap id="GAP-005" status="COMPLETED">
      <title>Missing QATrigger Enum Values</title>
      <evidence>
        <verification>PYTHONPATH=. python -c "from swarm_attack.qa.models import QATrigger; print(QATrigger.SCHEDULED_HEALTH, QATrigger.SPEC_COMPLIANCE)"</verification>
        <result>Both enum values exist</result>
      </evidence>
    </gap>
  </completed_gaps>

  <all_agents_verified>
    <agent name="BehavioralTesterAgent">
      <status>IMPLEMENTED</status>
      <file>swarm_attack/qa/agents/behavioral.py</file>
      <agent_name>behavioral_tester</agent_name>
    </agent>
    <agent name="ContractValidatorAgent">
      <status>IMPLEMENTED</status>
      <file>swarm_attack/qa/agents/contract.py</file>
      <agent_name>contract_validator</agent_name>
    </agent>
    <agent name="RegressionScannerAgent">
      <status>IMPLEMENTED</status>
      <file>swarm_attack/qa/agents/regression.py</file>
      <agent_name>regression_scanner</agent_name>
    </agent>
    <verification_command>
      <![CDATA[
PYTHONPATH=. python -c "
from swarm_attack.qa.agents import BehavioralTesterAgent, ContractValidatorAgent, RegressionScannerAgent
print('All 3 agents importable: OK')
print(f'  - BehavioralTesterAgent.name: {BehavioralTesterAgent.name}')
print(f'  - ContractValidatorAgent.name: {ContractValidatorAgent.name}')
print(f'  - RegressionScannerAgent.name: {RegressionScannerAgent.name}')
"
      ]]>
    </verification_command>
  </all_agents_verified>

  <remaining_work priority="OPTIONAL">
    <task id="OPT-001" priority="LOW">
      <title>Update QA_VALIDATION_REPORT.md</title>
      <description>The validation report is outdated (dated 2025-12-27, shows 821 tests, lists gaps as open). Update to reflect current 933 tests passing and all gaps closed.</description>
      <file>/Users/philipjcortes/Desktop/swarm-attack-qa-agent/docs/QA_VALIDATION_REPORT.md</file>
    </task>

    <task id="OPT-002" priority="LOW">
      <title>Separate QAStateStore class</title>
      <description>Architectural deviation - functionality is embedded in orchestrator.py. Non-blocking but technical debt.</description>
      <effort>4 hours</effort>
    </task>

    <task id="OPT-003" priority="LOW">
      <title>Response validation edge cases (10.5)</title>
      <description>Malformed JSON, non-UTF8, streaming responses - partially tested, could add more</description>
      <effort>4 hours</effort>
    </task>

    <task id="OPT-004" priority="LOW">
      <title>Git VCS edge cases (10.9)</title>
      <description>Detached HEAD, shallow clones, submodules - partially tested</description>
      <effort>4 hours</effort>
    </task>

    <task id="OPT-005" priority="LOW">
      <title>Security tests (10.11)</title>
      <description>XSS/injection detection, SSRF protection - partially tested</description>
      <effort>6 hours</effort>
    </task>
  </remaining_work>

  <quick_verification_commands>
    <command name="verify_agents">
      <![CDATA[
PYTHONPATH=. python -c "
from swarm_attack.qa.agents import BehavioralTesterAgent, ContractValidatorAgent, RegressionScannerAgent
print('All 3 agents: OK')
"
      ]]>
    </command>
    <command name="verify_enums">
      <![CDATA[
PYTHONPATH=. python -c "
from swarm_attack.qa.models import QATrigger
print('SCHEDULED_HEALTH:', hasattr(QATrigger, 'SCHEDULED_HEALTH'))
print('SPEC_COMPLIANCE:', hasattr(QATrigger, 'SPEC_COMPLIANCE'))
"
      ]]>
    </command>
    <command name="run_all_tests">
      <![CDATA[
PYTHONPATH=. python -m pytest tests/unit/qa/ tests/integration/qa/ -v --tb=short
      ]]>
    </command>
    <command name="test_count">
      <![CDATA[
PYTHONPATH=. python -m pytest tests/unit/qa/ tests/integration/qa/ --collect-only -q | tail -3
      ]]>
    </command>
  </quick_verification_commands>

  <test_file_inventory>
    <unit_tests>
      <file lines="756">tests/unit/qa/test_contract.py</file>
      <file lines="529">tests/unit/qa/test_request_generation_edge_cases.py</file>
      <file lines="508">tests/unit/qa/test_database_state_edge_cases.py</file>
      <file lines="421">tests/unit/qa/test_auth_edge_cases.py</file>
      <file>tests/unit/qa/test_behavioral.py</file>
      <file>tests/unit/qa/test_regression.py</file>
      <file>tests/unit/qa/test_orchestrator.py</file>
      <file>tests/unit/qa/test_models.py</file>
      <file>tests/unit/qa/test_context_builder.py</file>
      <file>tests/unit/qa/test_depth_selector.py</file>
      <file>tests/unit/qa/test_qa_config.py</file>
      <file>tests/unit/qa/test_verifier_hook.py</file>
      <file>tests/unit/qa/test_bug_researcher_hook.py</file>
      <file>tests/unit/qa/test_feature_pipeline_integration.py</file>
      <file>tests/unit/qa/test_bug_pipeline_integration.py</file>
      <file>tests/unit/qa/test_cos_autopilot.py</file>
      <file>tests/unit/qa/test_cos_goals.py</file>
      <file>tests/unit/qa/test_response_validation_edge_cases.py</file>
    </unit_tests>
    <integration_tests>
      <file>tests/integration/qa/test_qa_e2e.py</file>
      <file>tests/integration/qa/test_real_http.py</file>
      <file>tests/integration/qa/test_cli_integration.py</file>
      <file>tests/integration/qa/test_api_surface.py</file>
      <file>tests/integration/qa/test_hook_registration.py</file>
      <file>tests/integration/qa/test_skill_integration.py</file>
      <file>tests/integration/qa/test_performance.py</file>
      <file>tests/integration/qa/test_system_validation.py</file>
    </integration_tests>
  </test_file_inventory>

  <next_steps_for_team>
    <step priority="1">
      <action>Verify branch and environment</action>
      <command>cd /Users/philipjcortes/Desktop/swarm-attack-qa-agent && git branch --show-current</command>
      <expected>feature/adaptive-qa-agent</expected>
    </step>
    <step priority="2">
      <action>Quick verification (no full test run needed)</action>
      <commands>
        <![CDATA[
PYTHONPATH=. python -c "from swarm_attack.qa.agents import BehavioralTesterAgent, ContractValidatorAgent, RegressionScannerAgent; print('All agents: OK')"
PYTHONPATH=. python -c "from swarm_attack.qa.models import QATrigger; print('Enums:', QATrigger.SCHEDULED_HEALTH, QATrigger.SPEC_COMPLIANCE)"
        ]]>
      </commands>
    </step>
    <step priority="3">
      <action>Decide on optional work</action>
      <options>
        <option>Update validation report (30 min)</option>
        <option>Add more edge case tests (4-6 hrs per category)</option>
        <option>Refactor QAStateStore separation (4 hrs)</option>
        <option>Ship as-is - all critical work complete</option>
      </options>
    </step>
  </next_steps_for_team>

  <success_criteria status="ALL_MET">
    <criterion status="PASSED">ContractValidatorAgent fully implemented and importable</criterion>
    <criterion status="PASSED">All 3 agents (Behavioral, Contract, Regression) dispatch from orchestrator</criterion>
    <criterion status="PASSED">Missing enum values added to QATrigger</criterion>
    <criterion status="PASSED">Edge case tests added for spec sections 10.2, 10.4, 10.6</criterion>
    <criterion status="PASSED">All tests pass (933 tests, exceeds 850+ target)</criterion>
    <criterion status="PASSED">No regressions in existing functionality</criterion>
    <criterion status="NOT_DONE">Validation report NOT updated (optional)</criterion>
  </success_criteria>
</implementation_prompt>
