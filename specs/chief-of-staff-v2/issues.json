{
  "feature_id": "chief-of-staff-v2",
  "generated_at": "2025-12-18T14:50:00Z",
  "split_log": [
    {
      "original_issue": 7,
      "split_into": ["7a", "7b", "7c"],
      "reason": "13 acceptance criteria, 10+ methods - exceeds limits"
    },
    {
      "original_issue": "7c (now 9)",
      "split_into": ["9a", "9b"],
      "reason": "11 acceptance criteria - exceeds 8 max"
    }
  ],
  "issues": [
    {
      "title": "Add orchestrator dependency and tags field to DailyGoal",
      "body": "## Description\n\nAdd orchestrator dependencies to AutopilotRunner and extend DailyGoal with the `tags` field.\n\n## Acceptance Criteria\n\n- [ ] AutopilotRunner `__init__` accepts `orchestrator: Orchestrator` parameter\n- [ ] AutopilotRunner `__init__` accepts `bug_orchestrator: BugOrchestrator` parameter\n- [ ] DailyGoal dataclass has new `tags: list[str]` field\n- [ ] DailyGoal `to_dict()` and `from_dict()` handle the tags field\n- [ ] Unit tests for DailyGoal serialization with tags\n- [ ] Unit tests for AutopilotRunner initialization\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/goal_tracker.py`\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [],
      "order": 1
    },
    {
      "title": "Implement feature execution path in AutopilotRunner",
      "body": "## Description\n\nImplement the feature execution path that calls orchestrator.\n\n## Acceptance Criteria\n\n- [ ] `_execute_goal()` detects goals with `linked_feature` set\n- [ ] Calls `self.orchestrator.run_issue_session(feature_id=, issue_number=)` for feature goals\n- [ ] Returns `GoalExecutionResult` with success, cost_usd, duration_seconds, output\n- [ ] Maps orchestrator result status to success boolean\n- [ ] Handles exceptions and sets error_count on goal\n- [ ] Unit tests with mocked orchestrator\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [1],
      "order": 2
    },
    {
      "title": "Implement bug execution path in AutopilotRunner",
      "body": "## Description\n\nImplement bug execution path via BugOrchestrator.\n\n## Acceptance Criteria\n\n- [ ] `_execute_goal()` detects goals with `linked_bug` set\n- [ ] Calls `self.bug_orchestrator.fix(bug_id)` for bug goals\n- [ ] Returns `GoalExecutionResult` with success, cost_usd, duration_seconds, output\n- [ ] Maps bug orchestrator result.success to success boolean\n- [ ] Handles exceptions and sets error_count on goal\n- [ ] Unit tests with mocked bug orchestrator\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [1],
      "order": 3
    },
    {
      "title": "Implement spec pipeline execution path in AutopilotRunner",
      "body": "## Description\n\nImplement spec pipeline execution path.\n\n## Acceptance Criteria\n\n- [ ] `_execute_goal()` detects goals with `linked_spec` set\n- [ ] Calls `self.orchestrator.run_spec_pipeline(spec_id)` for spec goals\n- [ ] Returns `GoalExecutionResult` with success, cost_usd, duration_seconds\n- [ ] Handles generic goals (no linked artifact) with stub execution\n- [ ] Handles exceptions and sets error_count on goal\n- [ ] Unit tests for spec and generic execution paths\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [1],
      "order": 4
    },
    {
      "title": "Add pre-execution budget checks and estimated_cost_usd field",
      "body": "## Description\n\nAdd budget validation before goal execution.\n\n## Acceptance Criteria\n\n- [ ] DailyGoal has `estimated_cost_usd: Optional[float] = None` field\n- [ ] DailyGoal has `is_unplanned: bool = False` field\n- [ ] DailyGoal has `error_count: int = 0` field\n- [ ] DailyGoal has `is_hiccup: bool = False` field\n- [ ] ChiefOfStaffConfig has `min_execution_budget: float` (default 0.50)\n- [ ] `_execute_goal_with_budget_check()` checks budget before execution\n- [ ] Returns failure if `remaining_budget < min_execution_budget`\n- [ ] Unit tests for budget check logic\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/goal_tracker.py`\n- `swarm_attack/chief_of_staff/config.py`\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [1],
      "order": 5
    },
    {
      "title": "Create Checkpoint and CheckpointStore dataclasses",
      "body": "## Description\n\nCreate Checkpoint data model and CheckpointStore for persistence.\n\n## Acceptance Criteria\n\n- [ ] `CheckpointTrigger` enum with: UX_CHANGE, COST_SINGLE, COST_CUMULATIVE, ARCHITECTURE, SCOPE_CHANGE, HICCUP\n- [ ] `CheckpointOption` dataclass with label, description, is_recommended\n- [ ] `Checkpoint` dataclass with all fields (checkpoint_id, trigger, context, options, etc.)\n- [ ] `CheckpointResult` dataclass with requires_approval, approved, checkpoint\n- [ ] `CheckpointStore.save(checkpoint)` saves to JSON file\n- [ ] `CheckpointStore.get(checkpoint_id)` loads by ID\n- [ ] `CheckpointStore.list_pending()` returns pending checkpoints\n- [ ] Unit tests for all serialization and CRUD\n\n## File Operations\n\n**CREATE:**\n- `swarm_attack/chief_of_staff/checkpoints.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [],
      "order": 6
    },
    {
      "title": "Implement trigger detection for CheckpointSystem",
      "body": "## Description\n\nImplement CheckpointSystem class with trigger detection.\n\n## Acceptance Criteria\n\n- [ ] `CheckpointSystem` class with store, config dependencies\n- [ ] `_detect_triggers(goal)` method returns list of CheckpointTrigger\n- [ ] UX_CHANGE: tags contain ui, ux, frontend (case-insensitive)\n- [ ] COST_SINGLE: estimated_cost_usd > config.checkpoint_cost_single\n- [ ] COST_CUMULATIVE: daily_cost > config.checkpoint_cost_daily\n- [ ] ARCHITECTURE: tags contain architecture, refactor, core\n- [ ] SCOPE_CHANGE: is_unplanned == True\n- [ ] HICCUP: error_count > 0 or is_hiccup == True\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/checkpoints.py` (preserve: CheckpointTrigger, Checkpoint, CheckpointStore)\n- `swarm_attack/chief_of_staff/config.py` (add checkpoint_cost_single=5.0, checkpoint_cost_daily=15.0)",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [6],
      "order": 7
    },
    {
      "title": "Implement checkpoint creation methods",
      "body": "## Description\n\nImplement checkpoint creation methods for CheckpointSystem.\n\n## Acceptance Criteria\n\n- [ ] `_create_checkpoint(goal, trigger)` creates Checkpoint with context, options, recommendation\n- [ ] `_build_context(goal, trigger)` generates context string per trigger type\n- [ ] `_build_options(goal, trigger)` returns list: Proceed, Skip, Modify, Pause\n- [ ] `_build_recommendation(goal, trigger)` generates recommendation string\n- [ ] Proceed option marked as is_recommended for most triggers\n- [ ] Unit tests for checkpoint creation\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/checkpoints.py` (preserve: _detect_triggers)",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [7],
      "order": 8
    },
    {
      "title": "Implement check_before_execution for CheckpointSystem",
      "body": "## Description\n\nImplement the check_before_execution public API method.\n\n## Acceptance Criteria\n\n- [ ] `check_before_execution(goal)` returns CheckpointResult\n- [ ] Returns existing pending checkpoint if one exists for the goal\n- [ ] Creates new checkpoint if triggers detected and no pending exists\n- [ ] Returns CheckpointResult(requires_approval=False) if no triggers\n- [ ] Uses _detect_triggers and _create_checkpoint internally\n- [ ] Unit tests for check_before_execution\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/checkpoints.py` (preserve: _detect_triggers, _create_checkpoint, _build_*)",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [7, 8],
      "order": 9
    },
    {
      "title": "Implement resolve and cost tracking for CheckpointSystem",
      "body": "## Description\n\nImplement resolve_checkpoint and daily cost tracking.\n\n## Acceptance Criteria\n\n- [ ] `resolve_checkpoint(checkpoint_id, chosen_option, notes)` updates checkpoint status\n- [ ] Sets status to 'approved' if chosen_option is 'Proceed'\n- [ ] Sets status to 'rejected' for Skip/Modify/Pause\n- [ ] Stores chosen_option and human_notes on checkpoint\n- [ ] `update_daily_cost(cost)` increments daily cost tracking\n- [ ] `reset_daily_cost()` resets daily cost to 0\n- [ ] Unit tests for resolve and cost methods\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/checkpoints.py` (preserve: check_before_execution)",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [9],
      "order": 10
    },
    {
      "title": "Add checkpoint CLI commands",
      "body": "## Description\n\nAdd CLI commands for viewing and resolving checkpoints.\n\n## Acceptance Criteria\n\n- [ ] `swarm-attack cos checkpoints` lists all pending checkpoints\n- [ ] Shows trigger type, checkpoint ID, context, options with recommendations\n- [ ] `swarm-attack cos approve <checkpoint-id>` approves checkpoint\n- [ ] `swarm-attack cos approve <checkpoint-id> --notes \"message\"` approves with notes\n- [ ] `swarm-attack cos reject <checkpoint-id>` rejects checkpoint\n- [ ] `swarm-attack cos reject <checkpoint-id> --notes \"reason\"` rejects with notes\n- [ ] Error handling for invalid checkpoint IDs\n- [ ] Unit tests for CLI command parsing\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/cli.py` (add to cos_group)",
      "labels": ["enhancement", "backend", "cli", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [6, 10],
      "order": 11
    },
    {
      "title": "Integrate CheckpointSystem with AutopilotRunner",
      "body": "## Description\n\nIntegrate CheckpointSystem into AutopilotRunner's execution flow.\n\n## Acceptance Criteria\n\n- [ ] AutopilotRunner `__init__` accepts `checkpoint_system: CheckpointSystem`\n- [ ] `start()` calls `checkpoint_system.reset_daily_cost()` at session start\n- [ ] `_execute_goal()` calls `checkpoint_system.check_before_execution(goal)` before execution\n- [ ] If checkpoint requires approval and not approved, returns with `checkpoint_pending=True`\n- [ ] After each goal, calls `checkpoint_system.update_daily_cost(result.cost_usd)`\n- [ ] Execution loop breaks when checkpoint_pending\n- [ ] Unit tests for checkpoint integration\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [1, 10],
      "order": 12
    },
    {
      "title": "Create RecoveryManager with retry logic",
      "body": "## Description\n\nImplement RecoveryManager with retry and backoff logic.\n\n## Acceptance Criteria\n\n- [ ] `RecoveryLevel` enum with RETRY_SAME and ESCALATE values\n- [ ] `RecoveryManager` class with checkpoint_system dependency\n- [ ] `MAX_RETRIES = 3` and `BACKOFF_SECONDS = 5` constants\n- [ ] `execute_with_recovery(goal, action)` async method\n- [ ] Retries action up to MAX_RETRIES with exponential backoff (5s, 10s, 20s)\n- [ ] Increments `goal.error_count` on each failure\n- [ ] Returns immediately on success\n- [ ] Unit tests for retry logic and backoff\n\n## File Operations\n\n**CREATE:**\n- `swarm_attack/chief_of_staff/recovery.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [10],
      "order": 13
    },
    {
      "title": "Add escalation to checkpoint with hiccup marking",
      "body": "## Description\n\nImplement escalation path that creates HICCUP checkpoints.\n\n## Acceptance Criteria\n\n- [ ] `_escalate_to_human(goal, failure)` creates HICCUP checkpoint\n- [ ] Sets `goal.is_hiccup = True` before escalation\n- [ ] Checkpoint context includes retry count, goal content, error\n- [ ] Checkpoint options: Retry, Skip, Manual\n- [ ] Returns GoalExecutionResult with `checkpoint_pending=True`\n- [ ] Integrate RecoveryManager into AutopilotRunner._execute_goal()\n- [ ] Unit tests for escalation\n\n## File Operations\n\n**UPDATE:**\n- `swarm_attack/chief_of_staff/recovery.py`\n- `swarm_attack/chief_of_staff/autopilot_runner.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "small",
      "dependencies": [13],
      "order": 14
    },
    {
      "title": "Implement Episode logging and PreferenceLearner",
      "body": "## Description\n\nImplement episode logging and basic preference learning.\n\n## Acceptance Criteria\n\n- [ ] `Episode` dataclass with episode_id, timestamp, goal_id, success, cost_usd, etc.\n- [ ] `Episode.to_dict()` and `from_dict()` methods\n- [ ] `EpisodeStore` with JSONL storage at `.swarm/chief-of-staff/episodes/episodes.jsonl`\n- [ ] `EpisodeStore.save(episode)` appends to JSONL\n- [ ] `EpisodeStore.load_recent(limit=100)` loads recent episodes\n- [ ] `PreferenceLearner.record_decision(checkpoint)` extracts signals\n- [ ] AutopilotRunner logs Episode after each goal execution\n- [ ] Unit tests for Episode serialization\n\n## File Operations\n\n**CREATE:**\n- `swarm_attack/chief_of_staff/episodes.py`",
      "labels": ["enhancement", "backend", "chief-of-staff-v2"],
      "estimated_size": "medium",
      "dependencies": [10],
      "order": 15
    }
  ]
}
